
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Transfer Labels Using an Sklearn Classifier" />
<meta property="og:type" content="website" />
<meta property="og:url" content="tutorials/annotate/cell_type_annotation_with_a_label_transfer_model.html" />
<meta property="og:site_name" content="AnnDictionary" />
<meta property="og:description" content="This is a tutorial about how to do automated label transfer for two tissues at once, using an sklearn classifier and the anndict package to simplify the syntax. We’ll be using example data from Cel..." />
<meta property="og:image" content="_static/logo.png" />
<meta property="og:image:alt" content="AnnDictionary" />
<meta name="description" content="This is a tutorial about how to do automated label transfer for two tissues at once, using an sklearn classifier and the anndict package to simplify the syntax. We’ll be using example data from Cel..." />

    <title>Transfer Labels Using an Sklearn Classifier &#8212; AnnDictionary Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=4d2f5802"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/annotate/cell_type_annotation_with_a_label_transfer_model';</script>
    <link rel="canonical" href="https://ggit12.github.io/anndictionary/tutorials/annotate/cell_type_annotation_with_a_label_transfer_model.html" />
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Automated Annotation of Spatial Transcriptomics" href="automated_spatial_transcriptomic_annotation.html" />
    <link rel="prev" title="Cell Type Annotation with Large Language Models (LLMs)" href="cell_type_annotation_with_an_LLM.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.svg" class="logo__image only-light" alt="AnnDictionary Documentation - Home"/>
    <img src="../../_static/logo.svg" class="logo__image only-dark pst-js-only" alt="AnnDictionary Documentation - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>

<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/adata_dict/index.html">Core</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/adata_dict/adata_dict.html">AdataDict Class</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.set_hierarchy.html">anndict.AdataDict.set_hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.add_stratification.html">anndict.AdataDict.add_stratification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.flatten.html">anndict.AdataDict.flatten</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.fapply.html">anndict.AdataDict.fapply</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.fapply_return.html">anndict.AdataDict.fapply_return</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.index_bool.html">anndict.AdataDict.index_bool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.set_obs_index.html">anndict.AdataDict.set_obs_index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.set_var_index.html">anndict.AdataDict.set_var_index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.check_structure.html">anndict.AdataDict.check_structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.AdataDict.copy.html">anndict.AdataDict.copy</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/adata_dict/adata_dict_fapply.html">Iterate over AnnDictionaries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.adata_dict.adata_dict_fapply.html">anndict.adata_dict.adata_dict_fapply</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/adata_dict/build_write_read.html">Build, Write, and Read AnnDictionaries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.adata_dict.build_adata_dict.html">anndict.adata_dict.build_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.adata_dict.add_stratification.html">anndict.adata_dict.add_stratification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.adata_dict.write_adata_dict.html">anndict.adata_dict.write_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.adata_dict.read_adata_dict.html">anndict.adata_dict.read_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.adata_dict.read_adata_dict_from_h5ad.html">anndict.adata_dict.read_adata_dict_from_h5ad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/adata_dict/generated/anndict.adata_dict.concatenate_adata_dict.html">anndict.adata_dict.concatenate_adata_dict</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/llm/index.html">LLM Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/llm/llm_call.html">Configure and Call</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/llm/generated/anndict.configure_llm_backend.html">anndict.configure_llm_backend</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/llm/generated/anndict.get_llm_config.html">anndict.get_llm_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/llm/generated/anndict.call_llm.html">anndict.call_llm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/llm/generated/anndict.retry_call_llm.html">anndict.retry_call_llm</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/annotate/index.html">Annotate</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/annotate/cells/index.html">Cells</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/annotate/cells/de_novo.html">De Novo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/annotate/cells/label_transfer.html">Transfer Labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/annotate/cells/benchmarking.html">Benchmark</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/annotate/cells/error_correction.html">Error Correction</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/annotate/genes/index.html">Genes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/annotate/genes/make_gene_lists.html">Make Gene Lists</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/plot/index.html">Plot</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/plot/module_score_plots.html">Module Scores</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.module_score_barplot.html">anndict.plot.module_score_barplot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.module_score_umap.html">anndict.plot.module_score_umap</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/plot/annotate_genes_on_heatmap.html">Annotate Genes on Heatmap</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.annotate_gene_groups_with_ai_biological_process.html">anndict.plot.annotate_gene_groups_with_ai_biological_process</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/plot/confusion_matrix_plots.html">Confusion Matrix</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_confusion_matrix_from_adata.html">anndict.plot.plot_confusion_matrix_from_adata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_confusion_matrix.html">anndict.plot.plot_confusion_matrix</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/plot/sankey_plots.html">Sankey Plots</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_sankey.html">anndict.plot.plot_sankey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.save_sankey.html">anndict.plot.save_sankey</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/plot/agreement_bar_plots.html">Agreement Bar Plots</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_grouped_average.html">anndict.plot.plot_grouped_average</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_model_agreement.html">anndict.plot.plot_model_agreement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_model_agreement_categorical.html">anndict.plot.plot_model_agreement_categorical</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/plot/stabilizing_classifier_plots.html">Stabilizing Classifier</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_training_history.html">anndict.plot.plot_training_history</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/plot/generated/anndict.plot.plot_label_changes.html">anndict.plot.plot_label_changes</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/automated_label_management/index.html">Automated Label Management</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/automated_label_management/clean_single_column.html">Single Column</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.simplify_obs_column.html">anndict.simplify_obs_column</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.create_label_hierarchy.html">anndict.create_label_hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.map_cell_type_labels_to_simplified_set.html">anndict.map_cell_type_labels_to_simplified_set</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.simplify_var_index.html">anndict.simplify_var_index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.map_gene_labels_to_simplified_set.html">anndict.map_gene_labels_to_simplified_set</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/automated_label_management/unify_columns_within_adata.html">Within Adata</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.ensure_label_consistency_adata.html">anndict.ensure_label_consistency_adata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.ensure_label_consistency_main.html">anndict.ensure_label_consistency_main</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/automated_label_management/unify_columns_between_adata.html">Between Adata</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/automated_label_management/generated/anndict.ai_unify_labels.html">anndict.ai_unify_labels</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/utils/index.html">Utils</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/utils/anndictionary.html">AnnDictionary</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.enforce_semantic_list.html">anndict.utils.enforce_semantic_list</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.make_names.html">anndict.utils.make_names</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.normalize_string.html">anndict.utils.normalize_string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.normalize_label.html">anndict.utils.normalize_label</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.summarize_metadata.html">anndict.utils.summarize_metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.display_html_summary.html">anndict.utils.display_html_summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.create_color_map.html">anndict.utils.create_color_map</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.get_slurm_cores.html">anndict.utils.get_slurm_cores</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/utils/anndata.html">AnnData</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.get_adata_columns.html">anndict.utils.get_adata_columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.remove_genes.html">anndict.utils.remove_genes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.add_col_to_adata_obs.html">anndict.utils.add_col_to_adata_obs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.add_col_to_adata_var.html">anndict.utils.add_col_to_adata_var</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.add_col_to_pd_df.html">anndict.utils.add_col_to_pd_df</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.convert_obs_col_to_category.html">anndict.utils.convert_obs_col_to_category</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.convert_obs_col_to_string.html">anndict.utils.convert_obs_col_to_string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.convert_obs_index_to_str.html">anndict.utils.convert_obs_index_to_str</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.filter_gene_list.html">anndict.utils.filter_gene_list</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/utils/scanpy.html">Scanpy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.sample_and_drop.html">anndict.utils.sample_and_drop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.sample_adata_dict.html">anndict.utils.sample_adata_dict</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/utils/pca_density_filter.html">PCA Density Filter</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.pca_density_filter_adata.html">anndict.utils.pca_density_filter_adata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.pca_density_filter_main.html">anndict.utils.pca_density_filter_main</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/utils/stabilizing_classifier.html">Stabilizing Classifier</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.stable_label_adata.html">anndict.utils.stable_label_adata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.stable_label.html">anndict.utils.stable_label</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/utils/read_spatial_data.html">Read Spatial Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.build_adata_from_transcript_positions.html">anndict.utils.build_adata_from_transcript_positions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.build_adata_from_visium.html">anndict.utils.build_adata_from_visium</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.add_blank_image_to_adata.html">anndict.utils.add_blank_image_to_adata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.read_transcript_coords.html">anndict.utils.read_transcript_coords</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.get_steps_and_coords.html">anndict.utils.get_steps_and_coords</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.populate_sparse_array.html">anndict.utils.populate_sparse_array</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.process_gene_counts.html">anndict.utils.process_gene_counts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.create_anndata.html">anndict.utils.create_anndata</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/utils/uce.html">UCE</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/utils/generated/anndict.utils.uce_adata.html">anndict.utils.uce_adata</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/wrappers/index.html">Fapply Wrappers</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/wrappers/anndictionary.html">AnnDictionary</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.remove_genes_adata_dict.html">anndict.wrappers.remove_genes_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.ai_annotate_biological_process_adata_dict.html">anndict.wrappers.ai_annotate_biological_process_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.simplify_var_index_adata_dict.html">anndict.wrappers.simplify_var_index_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.ensure_label_consistency_adata_dict.html">anndict.wrappers.ensure_label_consistency_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.simplify_obs_column_adata_dict.html">anndict.wrappers.simplify_obs_column_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.create_label_hierarchy_adata_dict.html">anndict.wrappers.create_label_hierarchy_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.ai_annotate_cell_type_adata_dict.html">anndict.wrappers.ai_annotate_cell_type_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.ai_compare_cell_type_labels_pairwise_adata_dict.html">anndict.wrappers.ai_compare_cell_type_labels_pairwise_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.ai_annotate_cell_sub_type_adata_dict.html">anndict.wrappers.ai_annotate_cell_sub_type_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.ai_determine_leiden_resolution_adata_dict.html">anndict.wrappers.ai_determine_leiden_resolution_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.harmony_label_transfer_adata_dict.html">anndict.wrappers.harmony_label_transfer_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.plot_sankey_adata_dict.html">anndict.wrappers.plot_sankey_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.save_sankey_adata_dict.html">anndict.wrappers.save_sankey_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.plot_grouped_average_adata_dict.html">anndict.wrappers.plot_grouped_average_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.plot_label_changes_adata_dict.html">anndict.wrappers.plot_label_changes_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.plot_confusion_matrix_adata_dict.html">anndict.wrappers.plot_confusion_matrix_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.summarize_metadata_adata_dict.html">anndict.wrappers.summarize_metadata_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.display_html_summary_adata_dict.html">anndict.wrappers.display_html_summary_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.pca_density_adata_dict.html">anndict.wrappers.pca_density_adata_dict</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/wrappers/scanpy.html">Scanpy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.sample_and_drop_adata_dict.html">anndict.wrappers.sample_and_drop_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.normalize_adata_dict.html">anndict.wrappers.normalize_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.log_transform_adata_dict.html">anndict.wrappers.log_transform_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.set_high_variance_genes_adata_dict.html">anndict.wrappers.set_high_variance_genes_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.rank_genes_groups_adata_dict.html">anndict.wrappers.rank_genes_groups_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.scale_adata_dict.html">anndict.wrappers.scale_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.pca_adata_dict.html">anndict.wrappers.pca_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.neighbors_adata_dict.html">anndict.wrappers.neighbors_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.leiden_adata_dict.html">anndict.wrappers.leiden_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.leiden_sub_cluster.html">anndict.wrappers.leiden_sub_cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.leiden_sub_cluster_adata_dict.html">anndict.wrappers.leiden_sub_cluster_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.calculate_umap_adata_dict.html">anndict.wrappers.calculate_umap_adata_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/wrappers/generated/anndict.wrappers.plot_umap_adata_dict.html">anndict.wrappers.plot_umap_adata_dict</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/wrappers/squidpy.html">Squidpy</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Tutorials</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../adata_dict/index.html">Using the AdataDict Class</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../adata_dict/Build_AdataDict.html">Build an AdataDict</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adata_dict/Manipulate_the_Hierarchy.html">Manipulate the Hierarchy of an AdataDict</a></li>

<li class="toctree-l3"><a class="reference internal" href="../adata_dict/Iterate_Over_an_AdataDict.html">Iterate Over an AdataDict</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adata_dict/Write_and_Read_an_AdataDict.html">Write and Read AdataDict</a></li>
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">Annotating with AnnDictionary</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="automated_cell_type_marker_gene_scores.html">Automated Cell Type Marker Gene Scores</a></li>
<li class="toctree-l3"><a class="reference internal" href="cell_type_annotation_with_an_LLM.html">Cell Type Annotation with Large Language Models (LLMs)</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Transfer Labels Using an Sklearn Classifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="automated_spatial_transcriptomic_annotation.html">Automated Annotation of Spatial Transcriptomics</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contribute</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/ggit12/anndictionary" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/tutorials/annotate/cell_type_annotation_with_a_label_transfer_model.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Transfer Labels Using an Sklearn Classifier</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#skip-the-tutorial">Skip the tutorial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#on-a-single-adata">On a single adata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#on-many-adata-at-once">On many adata at once</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#begin-the-tutorial">Begin the tutorial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-test-data-from-cellxgene-census">1. Download test data from cellxgene census.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#split-the-data-by-tissue-so-that-we-can-use-a-separate-classifier-for-each-tissue">2. Split the data by <code class="docutils literal notranslate"><span class="pre">tissue</span></code> so that we can use a separate classifier for each tissue.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#randomly-split-the-data-into-origin-and-destination-data">3. Randomly split the data into <code class="docutils literal notranslate"><span class="pre">origin</span></code> and <code class="docutils literal notranslate"><span class="pre">destination</span></code> data.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downsample-large-cell-types-in-the-training-data-to-decrease-the-computational-burden-of-training-classifiers">4. Downsample large cell types in the training data (to decrease the computational burden of training classifiers).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drop-small-cell-types">5. Drop small cell types.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-a-label-classifier-on-each-tissue">6. Train a label classifier on each tissue.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-this-classifier-to-predict-aka-transfer-labels-for-the-destination-dataset">7. Use this classifier to predict (aka transfer) labels for the destination dataset.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-results-and-compare-to-the-manual-labels">8. Visualize the results and compare to the manual labels.</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="transfer-labels-using-an-sklearn-classifier">
<h1>Transfer Labels Using an Sklearn Classifier<a class="headerlink" href="#transfer-labels-using-an-sklearn-classifier" title="Link to this heading">#</a></h1>
<p>This is a tutorial about how to do automated label transfer for two tissues at once, using an <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> classifier and the <code class="docutils literal notranslate"><span class="pre">anndict</span></code> package to simplify the syntax. We’ll be using example data from Cellxgene census. Our goal is simple: transfer the cell type label from <code class="docutils literal notranslate"><span class="pre">origin_adata</span></code> to <code class="docutils literal notranslate"><span class="pre">destination_adata</span></code>.</p>
<section id="skip-the-tutorial">
<h2>Skip the tutorial<a class="headerlink" href="#skip-the-tutorial" title="Link to this heading">#</a></h2>
<p>In case you want to skip the tutorial, here’s all the code you need to run this type of label transfer.</p>
</section>
<section id="on-a-single-adata">
<h2>On a single adata<a class="headerlink" href="#on-a-single-adata" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#import adict package</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">anndict</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">adt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1">#load already labeled data</span>
<span class="n">origin_adata</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">read_adata_dict_from_h5ad</span><span class="p">(</span><span class="s2">&quot;path_to_your_data.h5ad&quot;</span><span class="p">)</span>

<span class="c1">#load unlabeled data</span>
<span class="n">destination_adata</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">read_adata_dict_from_h5ad</span><span class="p">(</span><span class="s2">&quot;path_to_your_data.h5ad&quot;</span><span class="p">)</span>

<span class="c1">#transfer the labels</span>
<span class="n">adt</span><span class="o">.</span><span class="n">transfer_labels_using_classifier</span><span class="p">(</span>
    <span class="n">origin_adata</span><span class="o">=</span><span class="n">origin_adata</span><span class="p">,</span>
    <span class="n">destination_adata</span><span class="o">=</span><span class="n">destination_adata</span><span class="p">,</span>
    <span class="n">origin_label_key</span><span class="o">=</span><span class="s2">&quot;cell_type&quot;</span><span class="p">,</span> 
    <span class="n">feature_key</span><span class="o">=</span><span class="s2">&quot;X_pca&quot;</span><span class="p">,</span> <span class="c1">#the key in origin_adata.obsm that contains the features you want to use for label transfer</span>
    <span class="n">classifier</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(),</span>
    <span class="n">new_column_name</span><span class="o">=</span><span class="s2">&quot;predicted_cell_type&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="c1">#for reproducibility</span>
    <span class="p">)</span>

<span class="c1">#save the labeled data</span>
<span class="n">adt</span><span class="o">.</span><span class="n">write_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="o">=</span><span class="n">destination_adata</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;path/to/your/labeled/adata_dict&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="on-many-adata-at-once">
<h2>On many adata at once<a class="headerlink" href="#on-many-adata-at-once" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#import adict package</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">anndict</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">adt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1">#load already labeled data</span>
<span class="n">origin_adata_dict</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">read_adata_dict_from_h5ad</span><span class="p">(</span><span class="s2">&quot;/path/to/your/labeled/adata&quot;</span><span class="p">)</span>

<span class="c1">#load unlabeled data</span>
<span class="n">destination_adata_dict</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">read_adata_dict_from_h5ad</span><span class="p">(</span><span class="s2">&quot;/path/to/your/unlabeled/adata&quot;</span><span class="p">)</span>

<span class="c1">#transfer the labels</span>
<span class="n">adt</span><span class="o">.</span><span class="n">adata_dict_fapply</span><span class="p">(</span>
    <span class="n">origin_adata_dict</span><span class="p">,</span>
    <span class="n">adt</span><span class="o">.</span><span class="n">transfer_labels_using_classifier</span><span class="p">,</span>
    <span class="n">destination_adata</span><span class="o">=</span><span class="n">destination_adata_dict</span><span class="p">,</span>
    <span class="n">origin_label_key</span><span class="o">=</span><span class="s2">&quot;cell_type&quot;</span><span class="p">,</span> 
    <span class="n">feature_key</span><span class="o">=</span><span class="s2">&quot;X_pca&quot;</span><span class="p">,</span> <span class="c1">#the key in origin_adata.obsm that contains the features you want to use for label transfer</span>
    <span class="n">classifier</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(),</span>
    <span class="n">new_column_name</span><span class="o">=</span><span class="s2">&quot;predicted_cell_type&quot;</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="c1">#for reproducibility</span>
    <span class="p">)</span>

<span class="c1">#save the labeled data</span>
<span class="n">adt</span><span class="o">.</span><span class="n">write_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="o">=</span><span class="n">destination_adata_dict</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;path/to/your/labeled/adata_dict&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="begin-the-tutorial">
<h2>Begin the tutorial<a class="headerlink" href="#begin-the-tutorial" title="Link to this heading">#</a></h2>
<p>The rest of this notebook is a detailed tutorial about how to transfer labels using <code class="docutils literal notranslate"><span class="pre">adata_dicts</span></code> to handle several samples at once.</p>
<p>For example, transfer labels between several tissues at once (i.e. with the same code):<br />
Origin —-&gt; Destination<br />
Labeled Liver —&gt; Unlabeled Liver<br />
Labeled Kidney —-&gt; Unlabeled Kidney</p>
<p>The steps that we’ll follow are:</p>
<ol class="arabic simple">
<li><p>Download test data from cellxgene census.</p></li>
<li><p>Split the data by <code class="docutils literal notranslate"><span class="pre">tissue</span></code> so that we can use a separate classifier for each tissue.</p></li>
<li><p>Randomly split the data into <code class="docutils literal notranslate"><span class="pre">origin</span></code> and <code class="docutils literal notranslate"><span class="pre">destination</span></code> data. This mean’s we’ll also have “ground truth” labels in the destination data that we can compare to (i.e. just the original labels).</p></li>
<li><p>Downsample large cell types in the training data (to decrease the computational burden of training classifiers).</p></li>
<li><p>Drop small cell types.</p></li>
<li><p>Train a label classifier on each tissue.</p></li>
<li><p>Use this classifier to predict (aka transfer) labels for the destination dataset.</p></li>
<li><p>Visualize the results and compare to the manual labels.</p></li>
</ol>
<section id="download-test-data-from-cellxgene-census">
<h3>1. Download test data from cellxgene census.<a class="headerlink" href="#download-test-data-from-cellxgene-census" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#1. Download the data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cellxgene_census</span>

<span class="n">census</span> <span class="o">=</span> <span class="n">cellxgene_census</span><span class="o">.</span><span class="n">open_soma</span><span class="p">(</span><span class="n">census_version</span><span class="o">=</span><span class="s2">&quot;2023-12-15&quot;</span><span class="p">)</span>
<span class="n">adata</span> <span class="o">=</span> <span class="n">cellxgene_census</span><span class="o">.</span><span class="n">get_anndata</span><span class="p">(</span>
    <span class="n">census</span><span class="p">,</span>
    <span class="n">organism</span> <span class="o">=</span> <span class="s2">&quot;homo_sapiens&quot;</span><span class="p">,</span>
    <span class="n">measurement_name</span> <span class="o">=</span> <span class="s2">&quot;RNA&quot;</span><span class="p">,</span>
    <span class="n">obs_value_filter</span> <span class="o">=</span> <span class="s2">&quot;(dataset_id == &#39;53d208b0-2cfd-4366-9866-c3c6114081bc&#39;) &amp; ((tissue_general == &#39;kidney&#39;) | (tissue_general == &#39;liver&#39;))&quot;</span><span class="p">,</span>
    <span class="n">obs_embeddings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;uce&quot;</span><span class="p">]</span> <span class="c1">#we can try training the label transfer model on different embeddings</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#import AnnDictionary</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">anndict</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">adt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here&#39;s what the data looks like</span>
<span class="n">adt</span><span class="o">.</span><span class="n">display_html_summary</span><span class="p">(</span><span class="n">adt</span><span class="o">.</span><span class="n">summarize_metadata</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span>  <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tissue&#39;</span><span class="p">,</span><span class="s1">&#39;cell_type&#39;</span><span class="p">,</span> <span class="s1">&#39;cell_type*tissue&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="display: flex; flex-wrap: wrap;"><div style="flex: 1; padding: 10px;"><h3>tissue</h3><table border="1"><tr><th></th><th>count</th></tr><tr><td>kidney</td><td>9641</td></tr><tr><td>liver</td><td>5007</td></tr></table></div><div style="flex: 1; padding: 10px;"><h3>cell_type</h3><table border="1"><tr><th></th><th>count</th></tr><tr><td>kidney epithelial cell</td><td>8331</td></tr><tr><td>macrophage</td><td>1702</td></tr><tr><td>hepatocyte</td><td>1558</td></tr><tr><td>monocyte</td><td>612</td></tr><tr><td>endothelial cell of hepatic sinusoid</td><td>421</td></tr><tr><td>mature NK T cell</td><td>376</td></tr><tr><td>endothelial cell</td><td>362</td></tr><tr><td>B cell</td><td>341</td></tr><tr><td>CD8-positive, alpha-beta T cell</td><td>241</td></tr><tr><td>CD4-positive helper T cell</td><td>181</td></tr><tr><td>T cell</td><td>146</td></tr><tr><td>erythrocyte</td><td>108</td></tr><tr><td>neutrophil</td><td>83</td></tr><tr><td>fibroblast</td><td>76</td></tr><tr><td>intrahepatic cholangiocyte</td><td>42</td></tr><tr><td>plasma cell</td><td>34</td></tr><tr><td>liver dendritic cell</td><td>34</td></tr></table></div><div style="flex: 1; padding: 10px;"><h3>cell_type x tissue</h3><table border="1"><tr><th></th><th>kidney</th><th>liver</th></tr><tr><td>B cell</td><td>341</td><td>0</td></tr><tr><td>CD4-positive helper T cell</td><td>181</td><td>0</td></tr><tr><td>CD8-positive, alpha-beta T cell</td><td>241</td><td>0</td></tr><tr><td>T cell</td><td>0</td><td>146</td></tr><tr><td>endothelial cell</td><td>95</td><td>267</td></tr><tr><td>endothelial cell of hepatic sinusoid</td><td>0</td><td>421</td></tr><tr><td>erythrocyte</td><td>0</td><td>108</td></tr><tr><td>fibroblast</td><td>0</td><td>76</td></tr><tr><td>hepatocyte</td><td>0</td><td>1558</td></tr><tr><td>intrahepatic cholangiocyte</td><td>0</td><td>42</td></tr><tr><td>kidney epithelial cell</td><td>8331</td><td>0</td></tr><tr><td>liver dendritic cell</td><td>0</td><td>34</td></tr><tr><td>macrophage</td><td>321</td><td>1381</td></tr><tr><td>mature NK T cell</td><td>131</td><td>245</td></tr><tr><td>monocyte</td><td>0</td><td>612</td></tr><tr><td>neutrophil</td><td>0</td><td>83</td></tr><tr><td>plasma cell</td><td>0</td><td>34</td></tr></table></div></div></div></div>
</div>
</section>
<section id="split-the-data-by-tissue-so-that-we-can-use-a-separate-classifier-for-each-tissue">
<h3>2. Split the data by <code class="docutils literal notranslate"><span class="pre">tissue</span></code> so that we can use a separate classifier for each tissue.<a class="headerlink" href="#split-the-data-by-tissue-so-that-we-can-use-a-separate-classifier-for-each-tissue" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#split the adata by tissue so that we can handle each separatley</span>
<span class="n">adata_dict</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">build_adata_dict</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">strata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tissue&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="randomly-split-the-data-into-origin-and-destination-data">
<h3>3. Randomly split the data into <code class="docutils literal notranslate"><span class="pre">origin</span></code> and <code class="docutils literal notranslate"><span class="pre">destination</span></code> data.<a class="headerlink" href="#randomly-split-the-data-into-origin-and-destination-data" title="Link to this heading">#</a></h3>
<p>This mean’s we’ll also have “ground truth” labels in the destination data that we can compare to (i.e. just the original labels).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">anndictionary</span></code> way of doing this is to write a function that takes <code class="docutils literal notranslate"><span class="pre">adata</span></code> and does what you want, then use <code class="docutils literal notranslate"><span class="pre">adata_dict_fapply()</span></code> to do <code class="docutils literal notranslate"><span class="pre">function</span></code> to each adata in <code class="docutils literal notranslate"><span class="pre">adata_dict</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">assign_training_test_split</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">42</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assigns 50/50 train/test split to adata by adding &#39;is_training&#39; column</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    adata</span>
<span class="sd">        AnnData object</span>

<span class="sd">    random_state</span>
<span class="sd">        Random seed for reproducibility</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
    <span class="n">train_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adata</span><span class="p">),</span> <span class="s2">&quot;destination&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">train_idx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
        <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adata</span><span class="p">)),</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
    <span class="p">)</span>
    <span class="n">train_mask</span><span class="p">[</span><span class="n">train_idx</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;origin&quot;</span>
    <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;is_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">train_mask</span><span class="p">)</span>

<span class="c1">#randomly split adata into 50/50 origin (train) and destination (test)</span>
<span class="n">adt</span><span class="o">.</span><span class="n">adata_dict_fapply</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">,</span> <span class="n">assign_training_test_split</span><span class="p">)</span>
<span class="n">adata_dict</span><span class="o">.</span><span class="n">add_stratification</span><span class="p">(</span><span class="n">strata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;is_origin&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_dict</span><span class="o">.</span><span class="vm">__class__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>anndict.adata_dict.adata_dict.AdataDict
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_dict</span> <span class="c1">#View the object</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{(&#39;destination&#39;,): {(&#39;liver&#39;,): AnnData object with n_obs × n_vars = 2504 × 60664
      obs: &#39;soma_joinid&#39;, &#39;dataset_id&#39;, &#39;assay&#39;, &#39;assay_ontology_term_id&#39;, &#39;cell_type&#39;, &#39;cell_type_ontology_term_id&#39;, &#39;development_stage&#39;, &#39;development_stage_ontology_term_id&#39;, &#39;disease&#39;, &#39;disease_ontology_term_id&#39;, &#39;donor_id&#39;, &#39;is_primary_data&#39;, &#39;self_reported_ethnicity&#39;, &#39;self_reported_ethnicity_ontology_term_id&#39;, &#39;sex&#39;, &#39;sex_ontology_term_id&#39;, &#39;suspension_type&#39;, &#39;tissue&#39;, &#39;tissue_ontology_term_id&#39;, &#39;tissue_general&#39;, &#39;tissue_general_ontology_term_id&#39;, &#39;raw_sum&#39;, &#39;nnz&#39;, &#39;raw_mean_nnz&#39;, &#39;raw_variance_nnz&#39;, &#39;n_measured_vars&#39;, &#39;is_origin&#39;
      var: &#39;soma_joinid&#39;, &#39;feature_id&#39;, &#39;feature_name&#39;, &#39;feature_length&#39;, &#39;nnz&#39;, &#39;n_measured_obs&#39;
      obsm: &#39;uce&#39;,
  (&#39;kidney&#39;,): AnnData object with n_obs × n_vars = 4821 × 60664
      obs: &#39;soma_joinid&#39;, &#39;dataset_id&#39;, &#39;assay&#39;, &#39;assay_ontology_term_id&#39;, &#39;cell_type&#39;, &#39;cell_type_ontology_term_id&#39;, &#39;development_stage&#39;, &#39;development_stage_ontology_term_id&#39;, &#39;disease&#39;, &#39;disease_ontology_term_id&#39;, &#39;donor_id&#39;, &#39;is_primary_data&#39;, &#39;self_reported_ethnicity&#39;, &#39;self_reported_ethnicity_ontology_term_id&#39;, &#39;sex&#39;, &#39;sex_ontology_term_id&#39;, &#39;suspension_type&#39;, &#39;tissue&#39;, &#39;tissue_ontology_term_id&#39;, &#39;tissue_general&#39;, &#39;tissue_general_ontology_term_id&#39;, &#39;raw_sum&#39;, &#39;nnz&#39;, &#39;raw_mean_nnz&#39;, &#39;raw_variance_nnz&#39;, &#39;n_measured_vars&#39;, &#39;is_origin&#39;
      var: &#39;soma_joinid&#39;, &#39;feature_id&#39;, &#39;feature_name&#39;, &#39;feature_length&#39;, &#39;nnz&#39;, &#39;n_measured_obs&#39;
      obsm: &#39;uce&#39;},
 (&#39;origin&#39;,): {(&#39;liver&#39;,): AnnData object with n_obs × n_vars = 2503 × 60664
      obs: &#39;soma_joinid&#39;, &#39;dataset_id&#39;, &#39;assay&#39;, &#39;assay_ontology_term_id&#39;, &#39;cell_type&#39;, &#39;cell_type_ontology_term_id&#39;, &#39;development_stage&#39;, &#39;development_stage_ontology_term_id&#39;, &#39;disease&#39;, &#39;disease_ontology_term_id&#39;, &#39;donor_id&#39;, &#39;is_primary_data&#39;, &#39;self_reported_ethnicity&#39;, &#39;self_reported_ethnicity_ontology_term_id&#39;, &#39;sex&#39;, &#39;sex_ontology_term_id&#39;, &#39;suspension_type&#39;, &#39;tissue&#39;, &#39;tissue_ontology_term_id&#39;, &#39;tissue_general&#39;, &#39;tissue_general_ontology_term_id&#39;, &#39;raw_sum&#39;, &#39;nnz&#39;, &#39;raw_mean_nnz&#39;, &#39;raw_variance_nnz&#39;, &#39;n_measured_vars&#39;, &#39;is_origin&#39;
      var: &#39;soma_joinid&#39;, &#39;feature_id&#39;, &#39;feature_name&#39;, &#39;feature_length&#39;, &#39;nnz&#39;, &#39;n_measured_obs&#39;
      obsm: &#39;uce&#39;,
  (&#39;kidney&#39;,): AnnData object with n_obs × n_vars = 4820 × 60664
      obs: &#39;soma_joinid&#39;, &#39;dataset_id&#39;, &#39;assay&#39;, &#39;assay_ontology_term_id&#39;, &#39;cell_type&#39;, &#39;cell_type_ontology_term_id&#39;, &#39;development_stage&#39;, &#39;development_stage_ontology_term_id&#39;, &#39;disease&#39;, &#39;disease_ontology_term_id&#39;, &#39;donor_id&#39;, &#39;is_primary_data&#39;, &#39;self_reported_ethnicity&#39;, &#39;self_reported_ethnicity_ontology_term_id&#39;, &#39;sex&#39;, &#39;sex_ontology_term_id&#39;, &#39;suspension_type&#39;, &#39;tissue&#39;, &#39;tissue_ontology_term_id&#39;, &#39;tissue_general&#39;, &#39;tissue_general_ontology_term_id&#39;, &#39;raw_sum&#39;, &#39;nnz&#39;, &#39;raw_mean_nnz&#39;, &#39;raw_variance_nnz&#39;, &#39;n_measured_vars&#39;, &#39;is_origin&#39;
      var: &#39;soma_joinid&#39;, &#39;feature_id&#39;, &#39;feature_name&#39;, &#39;feature_length&#39;, &#39;nnz&#39;, &#39;n_measured_obs&#39;
      obsm: &#39;uce&#39;}}
</pre></div>
</div>
</div>
</div>
</section>
<section id="downsample-large-cell-types-in-the-training-data-to-decrease-the-computational-burden-of-training-classifiers">
<h3>4. Downsample large cell types in the training data (to decrease the computational burden of training classifiers).<a class="headerlink" href="#downsample-large-cell-types-in-the-training-data-to-decrease-the-computational-burden-of-training-classifiers" title="Link to this heading">#</a></h3>
<p>and</p>
</section>
<section id="drop-small-cell-types">
<h3>5. Drop small cell types.<a class="headerlink" href="#drop-small-cell-types" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#subsample each origin/training data down to 1k cells per cell type, dropping cell types with fewer than 50 cells</span>
<span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;origin&#39;</span><span class="p">,)]</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">sample_and_drop_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;origin&#39;</span><span class="p">,)],</span> <span class="n">strata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">],</span> <span class="n">min_num_cells</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_obs</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Check the results, note that the &quot;origin&quot; data has been subsampled and had cell types with fewer than 50 cells removed</span>
<span class="c1">#The type of classifier that we&#39;ll use next doesn&#39;t handle highly imbalanced classes (i.e. a mix of small and large cell types (by count))</span>
<span class="n">summary_results</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">summarize_metadata_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;origin&#39;</span><span class="p">,)],</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cell_type*tissue&quot;</span><span class="p">])</span>
<span class="n">adt</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">display_html_summary_adata_dict</span><span class="p">(</span><span class="n">summary_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Summary for: (&#39;liver&#39;,)
</pre></div>
</div>
<div class="output text_html"><div style="display: flex; flex-wrap: wrap;"><div style="flex: 1; padding: 10px;"><h3>cell_type x tissue</h3><table border="1"><tr><th></th><th>liver</th></tr><tr><td>T cell</td><td>69</td></tr><tr><td>endothelial cell</td><td>126</td></tr><tr><td>endothelial cell of hepatic sinusoid</td><td>201</td></tr><tr><td>erythrocyte</td><td>68</td></tr><tr><td>hepatocyte</td><td>300</td></tr><tr><td>macrophage</td><td>300</td></tr><tr><td>mature NK T cell</td><td>129</td></tr><tr><td>monocyte</td><td>300</td></tr></table></div></div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Summary for: (&#39;kidney&#39;,)
</pre></div>
</div>
<div class="output text_html"><div style="display: flex; flex-wrap: wrap;"><div style="flex: 1; padding: 10px;"><h3>cell_type x tissue</h3><table border="1"><tr><th></th><th>kidney</th></tr><tr><td>B cell</td><td>171</td></tr><tr><td>CD4-positive helper T cell</td><td>95</td></tr><tr><td>CD8-positive, alpha-beta T cell</td><td>135</td></tr><tr><td>kidney epithelial cell</td><td>300</td></tr><tr><td>macrophage</td><td>162</td></tr><tr><td>mature NK T cell</td><td>64</td></tr></table></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Note the nesting structure of the adata_dict</span>
<span class="n">adata_dict</span><span class="o">.</span><span class="n">hierarchy</span> <span class="c1">#first level is origin/destination, second level is tissue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;is_origin&#39;, (&#39;tissue&#39;,))
</pre></div>
</div>
</div>
</div>
</section>
<section id="train-a-label-classifier-on-each-tissue">
<h3>6. Train a label classifier on each tissue.<a class="headerlink" href="#train-a-label-classifier-on-each-tissue" title="Link to this heading">#</a></h3>
<p>and</p>
</section>
<section id="use-this-classifier-to-predict-aka-transfer-labels-for-the-destination-dataset">
<h3>7. Use this classifier to predict (aka transfer) labels for the destination dataset.<a class="headerlink" href="#use-this-classifier-to-predict-aka-transfer-labels-for-the-destination-dataset" title="Link to this heading">#</a></h3>
<p>In this case, we have the UCE embedding already downloaded from cellxgene. So, we’ll use that for training and prediction.</p>
<p>However, you could use on anything. For example:</p>
<ul class="simple">
<li><p>Put some metadata columns from .obs into a .obsm key and use those features</p></li>
<li><p>Put some genes into a .obsm key and use those genes</p></li>
<li><p>Calculate a PCA embedding and use that</p></li>
<li><p>Directly on the raw counts, or normalized, or whatever you have in <code class="docutils literal notranslate"><span class="pre">.X</span></code>, just pass <code class="docutils literal notranslate"><span class="pre">feature_key='use_X'</span></code></p></li>
</ul>
<p>Note that the same .obsm key needs to be present in both the origin and destination data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now, transfer the labels from origin to destination</span>
<span class="c1">#If SLURM_CPUS_PER_TASK and/or SLURM_NTASKS environment variables are set, the function will automatically determine number of cores and multithread using adt.get_slurm_cores()</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">label_transfer_models</span> <span class="o">=</span> <span class="n">adt</span><span class="o">.</span><span class="n">adata_dict_fapply</span><span class="p">(</span>
                                    <span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;origin&#39;</span><span class="p">,)],</span>
                                    <span class="n">adt</span><span class="o">.</span><span class="n">transfer_labels_using_classifier</span><span class="p">,</span>
                                    <span class="n">destination_adata</span><span class="o">=</span><span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;destination&#39;</span><span class="p">,)],</span>
                                    <span class="n">origin_label_key</span><span class="o">=</span><span class="s1">&#39;cell_type&#39;</span><span class="p">,</span> 
                                    <span class="n">feature_key</span><span class="o">=</span><span class="s1">&#39;uce&#39;</span><span class="p">,</span> <span class="c1">#the key in origin_adata.obsm that contains the features you want to use for label transfer</span>
                                    <span class="n">classifier_class</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">,</span>
                                    <span class="n">new_column_name</span><span class="o">=</span><span class="s1">&#39;predicted_cell_type&#39;</span><span class="p">,</span>
                                    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span> <span class="c1">#for reproducibility</span>
                                    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-the-results-and-compare-to-the-manual-labels">
<h3>8. Visualize the results and compare to the manual labels.<a class="headerlink" href="#visualize-the-results-and-compare-to-the-manual-labels" title="Link to this heading">#</a></h3>
<p>There are a few plotting functions for label comparison in <code class="docutils literal notranslate"><span class="pre">anndictionary</span></code>. For the complete list, look at the following section of the online documentation: API &gt; Plot.</p>
<p>Here, we’ll do a few:</p>
<ul class="simple">
<li><p>UMAP Plots labeled by the ground truth and predicted cell types.</p></li>
<li><p>Confusion Matrices.</p></li>
<li><p>Sankey Plots.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adt</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">neighbors_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;destination&#39;</span><span class="p">,)],</span> <span class="n">use_rep</span><span class="o">=</span><span class="s1">&#39;uce&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adt</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">calculate_umap_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;destination&#39;</span><span class="p">,)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot UMAP</span>
<span class="n">adt</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">plot_umap_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">[(</span><span class="s1">&#39;destination&#39;</span><span class="p">,)],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">,</span> <span class="s1">&#39;predicted_cell_type&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting UMAP for key: (&#39;liver&#39;,)
</pre></div>
</div>
<img alt="../../_images/0f79ba31a4c51f1cbdc146964094f909bec9526da871295fbf0dc59ebe542b06.png" src="../../_images/0f79ba31a4c51f1cbdc146964094f909bec9526da871295fbf0dc59ebe542b06.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting UMAP for key: (&#39;kidney&#39;,)
</pre></div>
</div>
<img alt="../../_images/35a46123dac6397aa46c165bf55e22958e77c61f837c3c981065233090d5d4ec.png" src="../../_images/35a46123dac6397aa46c165bf55e22958e77c61f837c3c981065233090d5d4ec.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adt</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">plot_confusion_matrix_adata_dict</span><span class="p">(</span><span class="n">adata_dict</span><span class="p">[(</span><span class="s2">&quot;destination&quot;</span><span class="p">,)],</span> <span class="s1">&#39;cell_type&#39;</span><span class="p">,</span> <span class="s1">&#39;predicted_cell_type&#39;</span><span class="p">,</span>
                                     <span class="n">row_color_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_color_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f88e36c0e73e39bb2ab8cefdebca5ccc420fc2c708ba7b4c0c0112ca1dc0ae1c.png" src="../../_images/f88e36c0e73e39bb2ab8cefdebca5ccc420fc2c708ba7b4c0c0112ca1dc0ae1c.png" />
<img alt="../../_images/9cbdb635adb14cf9e6210939fa5b195d695f6e7b22004f65a01d098b2e4d12e5.png" src="../../_images/9cbdb635adb14cf9e6210939fa5b195d695f6e7b22004f65a01d098b2e4d12e5.png" />
</div>
</div>
</section>
</section>
</section>


                </article>
              

              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#skip-the-tutorial">Skip the tutorial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#on-a-single-adata">On a single adata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#on-many-adata-at-once">On many adata at once</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#begin-the-tutorial">Begin the tutorial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-test-data-from-cellxgene-census">1. Download test data from cellxgene census.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#split-the-data-by-tissue-so-that-we-can-use-a-separate-classifier-for-each-tissue">2. Split the data by <code class="docutils literal notranslate"><span class="pre">tissue</span></code> so that we can use a separate classifier for each tissue.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#randomly-split-the-data-into-origin-and-destination-data">3. Randomly split the data into <code class="docutils literal notranslate"><span class="pre">origin</span></code> and <code class="docutils literal notranslate"><span class="pre">destination</span></code> data.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downsample-large-cell-types-in-the-training-data-to-decrease-the-computational-burden-of-training-classifiers">4. Downsample large cell types in the training data (to decrease the computational burden of training classifiers).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drop-small-cell-types">5. Drop small cell types.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-a-label-classifier-on-each-tissue">6. Train a label classifier on each tissue.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-this-classifier-to-predict-aka-transfer-labels-for-the-destination-dataset">7. Use this classifier to predict (aka transfer) labels for the destination dataset.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-results-and-compare-to-the-manual-labels">8. Visualize the results and compare to the manual labels.</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By ggit12
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, ggit12.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>